# ç¡¬ä»¶é€‚é…æ”¹åŠ¨æ€»ç»“

æœ¬æ–‡æ¡£ç®€è¦åˆ—å‡ºäº† HLS CNN é¡¹ç›®ç¡¬ä»¶é€‚é…çš„æ‰€æœ‰æ–‡ä»¶æ”¹åŠ¨ã€‚

## ä¿®æ”¹çš„æ–‡ä»¶

### 1. `src/cnn_marco.h` - æ•°æ®ç±»å‹å®šä¹‰
**æ”¹åŠ¨**: æ·»åŠ å®šç‚¹ç±»å‹æ”¯æŒ
```cpp
#ifndef USE_FLOAT
    typedef ap_fixed<16, 8> data_t;    // ç¡¬ä»¶: 16ä½å®šç‚¹
    typedef ap_fixed<16, 8> weight_t;
    typedef ap_fixed<32, 16> acc_t;
#else
    typedef float data_t;              // Cä»¿çœŸ: æµ®ç‚¹
    typedef float weight_t;
    typedef float acc_t;
#endif
```

### 2. `src/hls_cnn.h` - æ¿€æ´»å‡½æ•°ä¼˜åŒ–
**æ”¹åŠ¨**: sigmoid å‡½æ•°æ·»åŠ ç¡¬ä»¶å‹å¥½çš„åˆ†æ®µçº¿æ€§è¿‘ä¼¼
```cpp
#ifdef USE_FLOAT
    return T(1.0) / (T(1.0) + exp(-float(x)));  // Cä»¿çœŸç”¨exp
#else
    return T(0.5) + T(0.25) * x;  // ç¡¬ä»¶ç”¨çº¿æ€§è¿‘ä¼¼
#endif
```

### 3. `tests/run_hls.tcl` - HLSè„šæœ¬
**æ”¹åŠ¨**: å®Œå…¨é‡å†™ä»¥æ”¯æŒ uut_top å’Œæ–°æµ‹è¯•æµç¨‹
- æ”¹å˜é¡¶å±‚å‡½æ•°: `cnn_inference` â†’ `uut_top`
- æ·»åŠ æ–°è®¾è®¡æ–‡ä»¶: `uut_top.cpp`, `uut_top.hpp`
- æ–°æµ‹è¯•æ–‡ä»¶: `test.cpp`
- ä¼˜åŒ– AXI é…ç½®

### 4. `Makefile` - æ„å»ºç³»ç»Ÿ
**æ”¹åŠ¨**: æ·»åŠ  HLS æµ‹è¯•ç›®æ ‡
- `make hls_csim` - HLS Cä»¿çœŸ
- `make hls_synth` - HLSç»¼åˆ
- `make hls_cosim` - HLS Co-ä»¿çœŸ
- `make hls_export` - å¯¼å‡ºIP
- `make hls_full` - å®Œæ•´æµç¨‹

## æ–°å¢çš„æ–‡ä»¶

### 5. `src/uut_top.hpp` - ç¡¬ä»¶é¡¶å±‚æ¥å£
**åŠŸèƒ½**: å£°æ˜ç¡¬ä»¶å¯ç»¼åˆçš„é¡¶å±‚å‡½æ•°
- extern "C" æ¥å£
- æ‰å¹³åŒ–æ•°ç»„å‚æ•° (å…¼å®¹AXI)
- 9ä¸ªå‚æ•°æ•°ç»„ (input + 4å±‚æƒé‡/åç½® + output)

### 6. `src/uut_top.cpp` - ç¡¬ä»¶é¡¶å±‚å®ç°
**åŠŸèƒ½**: åŒ…è£… cnn_inference ä¸ºç¡¬ä»¶æ¥å£
- HLS Interface pragma (s_axilite + m_axi)
- æ‰å¹³æ•°ç»„ â†’ å¤šç»´æ•°ç»„é‡ç»„
- æ•°ç»„åˆ†å‰²ä¼˜åŒ– (ARRAY_PARTITION)
- æµæ°´çº¿ä¼˜åŒ– (PIPELINE II=1)

### 7. `tests/test.cpp` - HLSæµ‹è¯•æ¡†æ¶
**åŠŸèƒ½**: C/Co-ä»¿çœŸæµ‹è¯•ä»£ç 
- ç”Ÿæˆæµ‹è¯•æ•°æ® (Xavieråˆå§‹åŒ–)
- æµ®ç‚¹/å®šç‚¹è½¬æ¢
- è°ƒç”¨ uut_top
- ç²¾åº¦å¯¹æ¯” (tolerance=0.1)

### 8. `HARDWARE_TESTING.md` - ç¡¬ä»¶æµ‹è¯•æŒ‡å—
**å†…å®¹**:
- æ•°æ®ç±»å‹è½¬æ¢è¯´æ˜
- HLSæ¥å£è®¾è®¡
- æµ‹è¯•æµç¨‹ (csim/synth/cosim)
- æ€§èƒ½åˆ†æä¸ä¼˜åŒ–
- å¸¸è§é—®é¢˜è§£å†³

### 9. `HARDWARE_ADAPTATION.md` - è¯¦ç»†æ”¹åŠ¨è¯´æ˜
**å†…å®¹**:
- å®Œæ•´æ”¹åŠ¨åˆ—è¡¨
- è®¾è®¡å†³ç­–è§£é‡Š
- éªŒè¯ç­–ç•¥
- æ€§èƒ½é¢„ä¼°
- ä¼˜åŒ–æ–¹å‘

### 10. `quick_test.sh` - å¿«é€Ÿæµ‹è¯•è„šæœ¬
**åŠŸèƒ½**: ä¸€é”®è¿è¡Œå®Œæ•´æµ‹è¯•æµç¨‹
```bash
./quick_test.sh
# è‡ªåŠ¨è¿è¡Œ: unit_test â†’ integration_test â†’ hls_csim â†’ hls_synth â†’ (å¯é€‰) hls_cosim
```

## æ–‡ä»¶æ ‘å¯¹æ¯”

### ä¿®æ”¹å‰
```
hls_cnn/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ hls_cnn.h
â”‚   â”œâ”€â”€ hls_cnn.cpp
â”‚   â””â”€â”€ cnn_marco.h
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit_test.cpp
â”‚   â”œâ”€â”€ integration_test.cpp
â”‚   â””â”€â”€ run_hls.tcl
â”œâ”€â”€ Makefile
â””â”€â”€ README.md
```

### ä¿®æ”¹å
```
hls_cnn/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ hls_cnn.h           (å·²ä¿®æ”¹)
â”‚   â”œâ”€â”€ hls_cnn.cpp
â”‚   â”œâ”€â”€ cnn_marco.h         (å·²ä¿®æ”¹)
â”‚   â”œâ”€â”€ uut_top.hpp         (æ–°å¢) â˜…
â”‚   â””â”€â”€ uut_top.cpp         (æ–°å¢) â˜…
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit_test.cpp
â”‚   â”œâ”€â”€ integration_test.cpp
â”‚   â”œâ”€â”€ test.cpp            (æ–°å¢) â˜…
â”‚   â””â”€â”€ run_hls.tcl         (å·²ä¿®æ”¹)
â”œâ”€â”€ Makefile                (å·²ä¿®æ”¹)
â”œâ”€â”€ README.md
â”œâ”€â”€ HARDWARE_TESTING.md     (æ–°å¢) â˜…
â”œâ”€â”€ HARDWARE_ADAPTATION.md  (æ–°å¢) â˜…
â””â”€â”€ quick_test.sh           (æ–°å¢) â˜…
```

## å¿«é€Ÿä½¿ç”¨æŒ‡å—

### 1. CPUæµ‹è¯• (å¼€å‘é˜¶æ®µ)
```bash
make unit_test          # 5ä¸ªå•å…ƒæµ‹è¯•
make integration_test   # ç«¯åˆ°ç«¯æµ‹è¯•
```

### 2. HLS Cä»¿çœŸ (éªŒè¯å®šç‚¹åŒ–)
```bash
make hls_csim          # ~1-2åˆ†é’Ÿ
```

### 3. HLSç»¼åˆ (ç”ŸæˆRTL)
```bash
make hls_synth         # ~5-10åˆ†é’Ÿ
```

### 4. ä¸€é”®æµ‹è¯• (æ¨è)
```bash
./quick_test.sh        # è‡ªåŠ¨è¿è¡Œæ‰€æœ‰æµ‹è¯•
```

### 5. æŸ¥çœ‹æŠ¥å‘Š
```bash
cd tests/hls_cnn_prj/solution1/syn/report
cat uut_top_csynth.rpt
```

## å…³é”®æŠ€æœ¯ç‚¹

### æ•°æ®ç±»å‹
- **ç¡¬ä»¶**: `ap_fixed<16, 8>` (16ä½å®šç‚¹, 8ä½æ•´æ•°)
- **ç´¯åŠ å™¨**: `ap_fixed<32, 16>` (é˜²æ­¢æº¢å‡º)
- **Cä»¿çœŸ**: `float` (é€šè¿‡ USE_FLOAT å®åˆ‡æ¢)

### HLSä¼˜åŒ–
- **æµæ°´çº¿**: `#pragma HLS PIPELINE II=1`
- **æ•°ç»„åˆ†å‰²**: `#pragma HLS ARRAY_PARTITION dim=1 cyclic factor=4`
- **æ¥å£**: `#pragma HLS INTERFACE mode=m_axi`

### AXIæ¥å£
- **æ§åˆ¶**: s_axilite (å¯„å­˜å™¨è®¿é—®)
- **æ•°æ®**: m_axi (å†…å­˜æ˜ å°„, 6ä¸ªç‹¬ç«‹bundle)

## éªŒè¯æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CPUæµ‹è¯•     â”‚ âœ“ åŠŸèƒ½éªŒè¯ (float)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HLS Cä»¿çœŸ   â”‚ âœ“ å®šç‚¹ç²¾åº¦éªŒè¯ (ap_fixed)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HLSç»¼åˆ     â”‚ âœ“ ç”ŸæˆRTL
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HLS Co-ä»¿çœŸ â”‚ âœ“ RTLéªŒè¯ (å¯é€‰,è€—æ—¶)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¯¼å‡ºIP      â”‚ â†’ Vivadoé›†æˆ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å…¼å®¹æ€§

- **Vitis HLS**: 2024.1+ (æ¨è 2024.2)
- **ç›®æ ‡å¹³å°**: Xilinx Alveo U200/U250/U280
- **ç¼–è¯‘å™¨**: C++14
- **æ“ä½œç³»ç»Ÿ**: Linux (Ubuntu 20.04+)

## ä¸‹ä¸€æ­¥

1. âœ… è¿è¡Œ `./quick_test.sh` éªŒè¯æ”¹åŠ¨
2. âœ… æŸ¥çœ‹ç»¼åˆæŠ¥å‘Šåˆ†ææ€§èƒ½
3. ğŸ”„ æ ¹æ®æŠ¥å‘Šè°ƒæ•´ä¼˜åŒ–å‚æ•°
4. ğŸ”„ é›†æˆåˆ° Vitis Accelerated Application
5. ğŸ”„ åœ¨çœŸå®FPGAæ¿å¡ä¸Šæµ‹è¯•

## è·å–å¸®åŠ©

- è¯¦ç»†æµ‹è¯•æŒ‡å—: `HARDWARE_TESTING.md`
- å®Œæ•´æ”¹åŠ¨è¯´æ˜: `HARDWARE_ADAPTATION.md`
- é¡¹ç›®æ€»è§ˆ: `README.md`
- Makeå¸®åŠ©: `make help`

## æ³¨æ„äº‹é¡¹

âš ï¸ **é‡è¦æç¤º**:
1. é¦–æ¬¡è¿è¡Œ HLS Cä»¿çœŸç¡®ä¿ Vitis HLS å·²æ­£ç¡®å®‰è£…
2. Co-ä»¿çœŸéå¸¸è€—æ—¶ (10-30åˆ†é’Ÿ), ä»…åœ¨æœ€ç»ˆéªŒè¯æ—¶ä½¿ç”¨
3. å®šç‚¹ç²¾åº¦æŸå¤±éœ€è¦è°ƒæ•´å®¹å¿åº¦ (0.1 æˆ–æ›´å¤§)
4. ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´ (ç»¼åˆäº§ç‰© ~1GB)

## ç‰ˆæœ¬å†å²

- **v1.0** (2025-01-XX): åˆå§‹ CPU æµ®ç‚¹å®ç°
- **v2.0** (2025-01-XX): ç¡¬ä»¶é€‚é… (æœ¬ç‰ˆæœ¬)
  - æ·»åŠ å®šç‚¹ç±»å‹æ”¯æŒ
  - åˆ›å»º uut_top ç¡¬ä»¶æ¥å£
  - å®ç° HLS æµ‹è¯•æ¡†æ¶
  - ä¼˜åŒ–æ¿€æ´»å‡½æ•°

---

**ç”Ÿæˆæ—¶é—´**: 2025-01-XX  
**ä½œè€…**: HLS CNN Project Team  
**è®¸å¯**: Apache 2.0
